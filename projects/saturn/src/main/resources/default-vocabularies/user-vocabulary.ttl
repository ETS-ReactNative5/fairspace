@prefix fs: <http://fairspace.io/ontology#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix schema: <http://www.schema.org/> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix osiris: <http://osiris.fairspace.io/ontology#> .
@prefix icdo3: <http://icdo3.fairspace.io/ontology#> .
@prefix fhir: <http://hl7.org/fhir/STU3/> .
@prefix dash: <http://datashapes.org/dash#> .

########################
###   User Shapes    ###
########################

## Augmented system class shapes
fs:FileShape sh:property
    [
        a fs:RelationShape ;
        sh:name "Analysed by" ;
        sh:description "The files associated to the analysis" ;
        sh:class <Analysis> ;
        sh:maxCount 1 ;
        sh:path <associatedAnalysis>
] .


fs:CollectionShape sh:property
    [
        a fs:RelationShape ;
        sh:name "Is about person" ;
        sh:description "Persons that are featured in this collection." ;
        sh:class foaf:Person ;
        sh:path <aboutPerson>
    ],
    [
        a fs:RelationShape ;
        sh:name "Is about biological sample." ;
        sh:description "Materials that are featured in this collection." ;
        sh:class osiris:BiologicalSample ;
        sh:path <aboutMaterial>
    ],
    [
        a fs:RelationShape ;
        sh:name "Part of project" ;
        sh:description "" ;
        sh:class <ResearchProject> ;
        sh:maxCount 1 ;
        sh:path <partOfProject>
] .


## User class Shapes

<PersonShape> a fs:ClassShape ;
    sh:closed false ;
    sh:description "A person that is subject of research." ;
    sh:name "Person" ;
    sh:targetClass foaf:Person ;
    sh:ignoredProperties ( rdf:type owl:sameAs ) ;
    sh:property
    [
        a fs:ControlledVocabularyPropertyShape ;
        sh:name "Gender" ;
        sh:description "The gender of the patient" ;
        sh:in (
                  "Male"
                  "Female"
                  "Unknown"
                  "Other"
              ) ;
        sh:maxCount 1 ;
        sh:path fhir:AdministrativeGender
    ],
    [
        a fs:DatatypePropertyShape ;
        sh:name "Age of death" ;
        sh:description "The age at which this person has died" ;
        sh:datatype xsd:date ;
        sh:maxCount 1 ;
        sh:path <ageOfDeath>
    ],
    [
        a fs:DatatypePropertyShape ;
        sh:name "Patient Identifier" ;
        sh:description "The identifier of the patient" ;
        sh:datatype xsd:string ;
        sh:maxCount 1 ;
        dash:singleLine true ;
        sh:path <patientIdentifier>
    ],
    [
        a fs:RelationShape ;
        sh:name "Event" ;
        sh:description "Tumor pathology events for this patient" ;
        sh:class osiris:TumorPathologyEvent ;
        sh:path <hasEvent>
    ],
    [
        a fs:RelationShape ;
        sh:name "Gave consent" ;
        sh:description "" ;
        sh:class <PersonConsent> ;
        sh:path <gaveConsent>
    ],
    [
        a fs:DatatypePropertyShape ;
        sh:name "Label" ;
        sh:description "Human readable label for this resource." ;
        sh:datatype xsd:string ;
        sh:maxCount 1 ;
        dash:singleLine true ;
        fs:fixedShape true ;
        fs:importantProperty true ;
        sh:path rdfs:label;
        sh:order 0
    ],
    [
        a fs:DatatypePropertyShape ;
        sh:name "Description" ;
        sh:description "Human friendly description." ;
        sh:datatype xsd:string ;
        sh:maxCount 1 ;
        fs:fixedShape true ;
        sh:path rdfs:comment
] .

<PersonConsentShape> a fs:ClassShape ;
    sh:closed false ;
    sh:description "A research consent given by person." ;
    sh:name "Person Consent" ;
    sh:targetClass <PersonConsent> ;
    sh:ignoredProperties ( rdf:type owl:sameAs ) ;
    sh:property
    [
        a fs:RelationShape ;
        sh:name "Consent for specific project" ;
        sh:description "" ;
        sh:class <ResearchProject> ;
        sh:path <isProjectConsent>
    ],
    [
        a fs:RelationShape ;
        sh:name "Consent authorizes" ;
        sh:description "The samples that is authorized with this consent" ;
        sh:class osiris:BiologicalSample ;
        sh:path <authorizes>
    ],
    [
        a fs:RelationShape ;
         sh:name "Is consent of" ;
         sh:description "" ;
         sh:class foaf:Person ;
         sh:maxCount 1 ;
         sh:path <isConsentOf>
    ],
    [
        a fs:DatatypePropertyShape ;
        sh:name "Label" ;
        sh:description "Human readable label for this resource." ;
        sh:datatype xsd:string ;
        sh:maxCount 1 ;
        dash:singleLine true ;
        fs:fixedShape true ;
        fs:importantProperty true ;
        sh:path rdfs:label;
        sh:order 0
    ],
    [
        a fs:DatatypePropertyShape ;
        sh:name "Description" ;
        sh:description "Human friendly description." ;
        sh:datatype xsd:string ;
        sh:maxCount 1 ;
        fs:fixedShape true ;
        sh:path rdfs:comment
] .

<ResearchProjectShape> a fs:ClassShape ;
    sh:closed false ;
    sh:description "A research project." ;
    sh:name "Research Project" ;
    sh:targetClass <ResearchProject> ;
    sh:ignoredProperties ( rdf:type owl:sameAs ) ;
    sh:property
    [
        a fs:DatatypePropertyShape ;
        sh:name "Project Code" ;
        sh:description "Specific project code." ;
        sh:datatype xsd:string ;
        sh:maxCount 1 ;
        dash:singleLine true ;
        sh:path <projectCode>
    ],
    [
        a fs:ControlledVocabularyPropertyShape ;
        sh:name "Investigation Nature" ;
        sh:description "choose between: basic research, biomedical research, clinical trial, medical diagnosis" ;
        sh:in (
                  "basic research"
                  "biomedical research"
                  "clinical trial"
                  "medical diagnosis"
              ) ;
        sh:path <investigationNature>
    ],
    [
        a fs:DatatypePropertyShape ;
        sh:name "Project Manager" ;
        sh:description "Project manager" ;
        sh:datatype xsd:string ;
        dash:singleLine true ;
        sh:path <projectManager>
    ],
    [
        a fs:RelationShape ;
        sh:name "Has associated collections" ;
        sh:description "Collections that are related to this project." ;
        sh:class fs:Collection ;
        sh:path <hasCollection>
    ],
    [
        a fs:RelationShape ;
        sh:name "Person consent" ;
        sh:description "" ;
        sh:class <PersonConsent> ;
        sh:path <hasPersonConsent>
    ],
    [
        a fs:DatatypePropertyShape ;
        sh:name "Label" ;
        sh:description "Human readable label for this resource." ;
        sh:datatype xsd:string ;
        sh:maxCount 1 ;
        dash:singleLine true ;
        fs:fixedShape true ;
        fs:importantProperty true ;
        sh:path rdfs:label;
        sh:order 0
    ],
    [
        a fs:DatatypePropertyShape ;
        sh:name "Description" ;
        sh:description "Human friendly description." ;
        sh:datatype xsd:string ;
        sh:maxCount 1 ;
        fs:fixedShape true ;
        sh:path rdfs:comment
] .

<TumorPathologyEventShape> a fs:ClassShape ;
    sh:closed false ;
    sh:description "Description for osiris:TumorPathologyEvent" ;
    sh:name "Tumor Pathology Event" ;
    sh:targetClass osiris:TumorPathologyEvent ;
    sh:ignoredProperties ( rdf:type owl:sameAs ) ;
    sh:property
    [
        a fs:ControlledVocabularyPropertyShape ;
        sh:name "Neoplasm Event" ;
        sh:description "The type of tumor event." ;
        sh:in (
                  "primary tumor"
                  "local relapse"
                  "metastatic relapse"
              ) ;
        sh:maxCount 1 ;
        sh:path osiris:EventType
    ],
    [
        a fs:DatatypePropertyShape ;
        sh:name "Neoplasm Event Start Date" ;
        sh:description "The start date of the tumor event" ;
        sh:datatype xsd:date ;
        sh:maxCount 1 ;
        sh:path osiris:EventStartDate
    ],
    [
        a fs:DatatypePropertyShape ;
        sh:name "Neoplasm Event End Date" ;
        sh:description "The end date of the tumor event" ;
        sh:datatype xsd:date ;
        sh:maxCount 1 ;
        sh:path osiris:EventEndDate
    ],
    [
        a fs:DatatypePropertyShape ;
        sh:name "Neoplasm diagnosis date" ;
        sh:description "The date of tumor diagnosis" ;
        sh:datatype xsd:date ;
        sh:maxCount 1 ;
        sh:path <diagnosisDate>
    ],
    [
        a fs:RelationShape ;
        sh:name "Event is analysed by" ;
        sh:description "Analyses associated with this tumor pathology event" ;
        sh:class <Analysis> ;
        sh:path <isAnalysedBy>
    ],
    [
        a fs:RelationShape ;
        sh:name "Event subject" ;
        sh:description "The patient associated with this event" ;
        sh:class foaf:Person ;
        sh:maxCount 1 ;
        sh:path <eventSubject>
    ],
    [
        a fs:RelationShape ;
        sh:name "Event parentage" ;
        sh:description "The tumor events could be linked to others as a chain. For example, a primary tumor event could be linked to a local relapse and then a metastatic relapse." ;
        sh:class osiris:TumorPathologyEvent ;
        sh:path <isLinkedTo>
    ],
    [
        a fs:DatatypePropertyShape ;
        sh:name "Label" ;
        sh:description "Human readable label for this resource." ;
        sh:datatype xsd:string ;
        sh:maxCount 1 ;
        dash:singleLine true ;
        fs:fixedShape true ;
        fs:importantProperty true ;
        sh:path rdfs:label;
        sh:order 0
    ],
    [
        a fs:DatatypePropertyShape ;
        sh:name "Description" ;
        sh:description "Human friendly description." ;
        sh:datatype xsd:string ;
        sh:maxCount 1 ;
        fs:fixedShape true ;
        sh:path rdfs:comment
] .

<BiologicalSampleShape> a fs:ClassShape ;
    sh:closed false ;
    sh:description "Description for osiris:BiologicalSample" ;
    sh:name "Biological Sample" ;
    sh:targetClass osiris:BiologicalSample ;
    sh:ignoredProperties ( rdf:type owl:sameAs ) ;
    sh:property
    [
        a fs:DatatypePropertyShape ;
        sh:name "Collect Date" ;
        sh:description "The collect date of the biological sample" ;
        sh:datatype xsd:date ;
        sh:maxCount 1 ;
        sh:path <collectDate>
    ],
    [
        a fs:DatatypePropertyShape ;
        sh:name "Tumor Cellularity" ;
        sh:description "The percentage of tumor cells in the biological sample (pathological measure)" ;
        sh:datatype xsd:integer ;
        sh:maxCount 1 ;
        sh:path <tumorCellularity>
    ],
    [
        a fs:RelationShape ;
        sh:name "Sample is authorized by" ;
        sh:description "The relevent consent" ;
        sh:class <PersonConsent> ;
        sh:maxCount 1 ;
        sh:path <isAuthorizedBy>
    ],
    [
        a fs:RelationShape ;
        sh:name "Sample has children" ;
        sh:description "The biological sample has child samples extracted (ex : tissue DNA extraction)" ;
        sh:class osiris:BiologicalSample ;
        sh:path <isParentOf>
    ],
    [
        a fs:RelationShape ;
        sh:name "Sample is child sample of" ;
        sh:description "The biological sample has been extracted from this parent sample" ;
        sh:class osiris:BiologicalSample ;
        sh:path <isChildOf>
    ],
    [
        a fs:DatatypePropertyShape ;
        sh:name "Label" ;
        sh:description "Human readable label for this resource." ;
        sh:datatype xsd:string ;
        sh:maxCount 1 ;
        dash:singleLine true ;
        fs:fixedShape true ;
        fs:importantProperty true ;
        sh:path rdfs:label;
        sh:order 0
    ],
    [
        a fs:DatatypePropertyShape ;
        sh:name "Description" ;
        sh:description "Human friendly description." ;
        sh:datatype xsd:string ;
        sh:maxCount 1 ;
        fs:fixedShape true ;
        sh:path rdfs:comment
] .

<AnalysisShape> a fs:ClassShape ;
    sh:closed false ;
    sh:description "Description for Analysis" ;
    sh:name "Analysis" ;
    sh:targetClass <Analysis> ;
    sh:ignoredProperties ( rdf:type owl:sameAs ) ;
    sh:property
    [
        a fs:DatatypePropertyShape ;
        sh:name "Analysis code" ;
        sh:description "The analysis run identifier" ;
        sh:datatype xsd:string ;
        sh:maxCount 1 ;
        dash:singleLine true ;
        sh:path <analysisCode>
    ],
    [
        a fs:DatatypePropertyShape ;
        sh:name "Analytic pipeline code" ;
        sh:description "Identifier of the pipeline used into the analysis (unique in the center)" ;
        sh:datatype xsd:string ;
        sh:maxCount 1 ;
        dash:singleLine true ;
        sh:path <analyticPipelineCode>
    ],
    [
        a fs:DatatypePropertyShape ;
        sh:name "Number of break points" ;
        sh:description "Calculated number of break points in genomic profile" ;
        sh:datatype xsd:integer ;
        sh:maxCount 1 ;
        sh:path <numberOfBreakPoints>
    ],
    [
        a fs:RelationShape ;
        sh:name "Analysis files" ;
        sh:description "The analysis linked to the files" ;
        sh:class fs:File ;
        sh:path <associatedFiles>
    ],
    [
        a fs:DatatypePropertyShape ;
        sh:name "Label" ;
        sh:description "Human readable label for this resource." ;
        sh:datatype xsd:string ;
        sh:maxCount 1 ;
        dash:singleLine true ;
        fs:fixedShape true ;
        fs:importantProperty true ;
        sh:path rdfs:label;
        sh:order 0
    ],
    [
        a fs:DatatypePropertyShape ;
        sh:name "Description" ;
        sh:description "Human friendly description." ;
        sh:datatype xsd:string ;
        sh:maxCount 1 ;
        fs:fixedShape true ;
        sh:path rdfs:comment
] .

########################
###   User Classes   ###
########################

foaf:Person a fs:Class .
<PersonConsent> a fs:Class .
<ResearchProject> a fs:Class .
osiris:TumorPathologyEvent a fs:Class .
osiris:BiologicalSample a fs:Class .
<Analysis> a fs:Class .

########################
### User Properties  ###
########################

rdfs:label a rdf:Property .
rdfs:comment a rdf:Property .
<projectCode> a rdf:Property .
<investigationNature>  a rdf:Property .
<projectManager> a rdf:Property .
fhir:AdministrativeGender a rdf:Property .
<ageOfDeath> a rdf:Property .
<patientIdentifier> a rdf:Property .
osiris:EventType a rdf:Property .
osiris:EventStartDate a rdf:Property .
osiris:EventEndDate a rdf:Property .
<diagnosisDate> a rdf:Property .
icdo3:Topography a rdf:Property .
icdo3:Morphology a rdf:Property .
osiris:Laterality a rdf:Property .
<collectDate> a rdf:Property .
osiris:SampleOrigin a rdf:Property .
osiris:StorageTemperature a rdf:Property .
<tumorCellularity> a rdf:Property .
<analysisCode> a rdf:Property .
osiris:AnalysisType a rdf:Property .
osiris:AnalysisDate a rdf:Property .
osiris:TechnicalProtocol a rdf:Property .
osiris:PlatformName a rdf:Property .
<analyticPipelineCode> a rdf:Property .
<AlgorithmicCellularity> a rdf:Property .
osiris:AlgorithmicPloidy a rdf:Property .
<numberOfBreakPoints> a rdf:Property .

## User relations

<hasData> a rdf:Property .
<aboutPerson> a rdf:Property .
<aboutMaterial> a rdf:Property .

<derivesFrom> a rdf:Property ;
    owl:inverseOf <providesMaterial> .

<providesMaterial> a rdf:Property ;
    owl:inverseOf <derivesFrom> .

<isConsentOf> a rdf:Property ;
    owl:inverseOf <gaveConsent> .

<gaveConsent> a rdf:Property ;
    owl:inverseOf <isConsentOf> .

<hasCollection> a rdf:Property ;
    owl:inverseOf <partOfProject> .

<partOfProject> a rdf:Property ;
    owl:inverseOf <hasCollection> .

<isProjectConsent> a rdf:Property ;
    owl:inverseOf <hasPersonConsent> .

<hasPersonConsent> a rdf:Property ;
    owl:inverseOf <isProjectConsent> .

<isAnalysedBy> a rdf:Property ;
    owl:inverseOf <analysisOfEvent> .

<analysisOfEvent> a rdf:Property ;
    owl:inverseOf <isAnalysedBy> .

<authorizes> a rdf:Property ;
    owl:inverseOf <isAuthorizedBy> .

<isAuthorizedBy> a rdf:Property ;
    owl:inverseOf <authorizes> .

<hasEvent> a rdf:Property ;
    owl:inverseOf <eventSubject> .

<eventSubject> a rdf:Property ;
    owl:inverseOf <hasEvent> .

<associatedAnalysis> a rdf:Property ;
    owl:inverseOf <associatedFiles> .

<associatedFiles> a rdf:Property ;
    owl:inverseOf <associatedAnalysis> .

<isParentOf> a rdf:Property ;
    owl:inverseOf <isChildOf> .

<isChildOf> a rdf:Property ;
    owl:inverseOf <isParentOf> .

<isLinkedTo> a rdf:Property ;
    owl:inverseOf <isLinkedTo> .
