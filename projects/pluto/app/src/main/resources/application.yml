app:
  apiVersion:
    pluto: v1
    saturn: v1
    elasticSearch: v1
  oauth2:
    base-url: http://localhost:9080
    realm: keycloak

server:
  error:
    whitelabel:
      enabled: false
  max-http-header-size: 65535

frontend:
  urls: {}
  roles: {}

spring:
  application:
    name: Pluto
  sleuth:
    sampler:
      probability: 1.0
  zipkin:
    base-url: http://jaeger-collector.jaeger:9411/

security:
  oidc:
    auth-url: ${app.oauth2.base-url}/auth/realms/${app.oauth2.realm}/protocol/openid-connect/auth
    logout-url: ${app.oauth2.base-url}/auth/realms/${app.oauth2.realm}/protocol/openid-connect/logout?redirect_uri=%s
    token-url: ${app.oauth2.base-url}/auth/realms/${app.oauth2.realm}/protocol/openid-connect/token
    jwk-key-set-url: ${app.oauth2.base-url}/auth/realms/${app.oauth2.realm}/protocol/openid-connect/certs
    redirect-after-logout-url: https://fairspace.com
    clientId: web_app
    clientSecret: web_app
    scope: openid
    required-authority: user-workspace

  # Specify urls for security configuration. There are
  urls:
    permitAll:
    - /actuator/health
    - /error
    - /manifest.json
    - /login
    - /logout
    - /authorize
    - /api/${app.apiVersion.pluto}/account/tokens
    needsAuthentication:
    - /api/${app.apiVersion.pluto}/account/name
    - /*
    needsAuthorization:
    - /api/${app.apiVersion.pluto}/account/authorizations
    - /api/*

workspace:
  name: Workspace
  version: 0.0.0

keycloak:
  workspace-login-group: workspace-users
  groupUri: ${app.oauth2.base-url}/auth/admin/realms/${app.oauth2.realm}/groups/?max=1&search=${keycloak.workspace-login-group}

  # The URI pattern has 2 parameters: the groupId and a query string
  usersUriPattern: ${app.oauth2.base-url}/auth/admin/realms/${app.oauth2.realm}/groups/%s/members?%s

zuul:
  retryable: false
  routes:
    # Please note that the order of the routes is relevant
    # The elasticsearch route must be defined before
    # saturn, which must be defined before ui, because of the
    # paths they listen to
    elasticsearch:
      path: /api/${app.apiVersion.elasticSearch}/search/*/_search
      url: http://elasticsearch/
    storage:
      # The webdav URL is not only used in the request URI, but also in headers (e.g. Destination)
      # To avoid rewriting these headers, it is suggested that the path on the proxy is the same
      # as the path on the upstream service for webdav calls.
      path: /webdav/${app.apiVersion.saturn}/**
      url: http://saturn/
      strip-prefix: false
    saturn:
      path: /api/${app.apiVersion.saturn}/**
      url: http://saturn/
      strip-prefix: false
    ui:
      path: /**
      url: http://mercury/
  ignored-patterns:
  - /actuator/**
  - /api/${app.apiVersion.pluto}/account/**
  - /api/${app.apiVersion.pluto}/workspace/**
  - /login
  - /logout
  - /authorize
  - /error
  add-host-header: true
  ignored-headers:
    - Access-Control-Allow-Credentials
    - Access-Control-Allow-Origin
    - Pragma
    - X-Frame-Options
    - X-Content-Type-Options
    - X-XSS-Protection
  host:
    socket-timeout-millis: 10000
    connect-timeout-millis: 2000
