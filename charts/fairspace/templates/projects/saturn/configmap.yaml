apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-saturn
  labels:
    app: saturn
    chart: {{ printf "%s-%s" .Chart.Name .Chart.Version | replace "+" "_" | trunc 63 | trimSuffix "-" }}
    release: {{ .Release.Name }}
    heritage: {{ .Release.Service }}
data:
  application.yaml: |-
    port: 8080
    publicUrl: https://{{ .Values.fairspace.ingress.domain }}
    elasticsearchUrl: {{ template "elasticsearch.baseurl" . }}
    jena:
      metadataBaseIRI: http://{{ .Values.fairspace.ingress.domain }}/iri/
      datasetPath: "/data/saturn/db"
      storeParams:
{{ toYaml .Values.saturn.storeParams | indent 8 }}
      transactionLogPath: "/data/saturn/files/log"
      bulkTransactions: {{ .Values.saturn.bulkTransactions }}
{{ if .Values.external.elasticsearch.enabled }}
      elasticSearch:
        settings:
          hostToPortMapping:
            {{ .Values.external.elasticsearch.transport.host }}: {{ .Values.external.elasticsearch.transport.port }}
          clusterName: "elasticsearch"
          shards: 1
          replicas: 1
{{ end }}
    auth:
      authServerUrl: {{ .Values.external.keycloak.baseUrl }}/auth/
      realm: {{ .Values.external.keycloak.realm }}
      clientId: {{ .Values.external.keycloak.clientId }}
      enableBasicAuth: {{ .Values.saturn.auth.enableBasicAuth }}
      superAdminUser: organisation-admin-{{ .Values.external.keycloak.realm }}
    webDAV:
      blobStorePath: "/data/saturn/files/blobs"
    services:
      {{ if ( and .Values.services .Values.services.jupyterhub  ) }}"jupyterhub": "{{ .Values.services.jupyterhub }}"{{ end }}
      {{ if ( and .Values.services .Values.services.cbioportal  ) }}"cbioportal": "{{ .Values.services.cbioportal }}"{{ end }}
    features:
{{ toYaml .Values.fairspace.features | indent 6 }}
    mail:
{{ toYaml .Values.saturn.mail | indent 6 }}
  vocabulary.ttl: |
{{ if .Values.saturn.vocabulary }}
{{ .Values.saturn.vocabulary | indent 4 }}
{{ else }}
{{ .Files.Get "vocabulary.ttl" | indent 4  }}
{{ end }}
   

